<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Watermark.Win</title>
    <base href="/" />
    <!--<link href="css/bootstrap/bootstrap.min.css" rel="stylesheet" />-->
    <link href="css/app.css" rel="stylesheet" />
    <link href="css/materialdesign/v7.1.96/css/materialdesignicons.min.css" rel="stylesheet" />

    <link href="_content/Masa.Blazor/css/masa-blazor.min.css" rel="stylesheet" />
    <link href="Watermark.Win.styles.css" rel="stylesheet" />
    <link href="css/google.css" rel="stylesheet" />
</head>


<body>
    <div id="app">
        <div class="modal-overlay">
            <div class="sk-wave">
                <div class="sk-wave-rect"></div>
                <div class="sk-wave-rect"></div>
                <div class="sk-wave-rect"></div>
                <div class="sk-wave-rect"></div>
                <div class="sk-wave-rect"></div>
            </div>
        </div>
    </div>

    <div id="blazor-error-ui" data-nosnippet>
        An unhandled error has occurred.
        <a href="" class="reload">Reload</a>
        <a class="dismiss">🗙</a>
    </div>
    <script src="_framework/blazor.webview.js"></script>
    <script src="_content/Masa.Blazor/js/masa-blazor.js"></script>
    <script src="_content/MudBlazor/MudBlazor.min.js"></script>

</body>
</html>


<script>
    function byteToUrl(blob) {
        // 适配webview和web
        var myBlob = new Blob([blob], { type: "image/jpeg" });
        return (window.URL || window.webkitURL || window || {}).createObjectURL(myBlob);
    }
    /**
    * 释放url对象，因为createObjectURL创建的对象一直会存在可能会占用过多的内存，请注意释放
    */
    function revokeUrl(url) {
        (window.URL || window.webkitURL || window || {}).revokeObjectURL(url);
    }

    function attachDragEvents(element) {
        console.log(element);
        alert(1)
        var elementRef = DotNetReference.invokeMethodAsync('Watermark.Razor.Components', 'HandleFiles', element);

        document.getElementById(element).addEventListener('dragenter', function (e) {
            e.stopPropagation();
            e.preventDefault();
        });

        document.getElementById(element).addEventListener('dragover', function (e) {
            e.stopPropagation();
            e.preventDefault();
        });

        document.getElementById(element).addEventListener('drop', function (e) {
            e.stopPropagation();
            e.preventDefault();

            var files = e.dataTransfer.files;
            elementRef.then(dotNetObject => {
                dotNetObject.invokeMethodAsync('Watermark.Razor.Components.HandleFiles', files);
            });
        });
    }
</script>