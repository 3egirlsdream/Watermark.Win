<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>Watermark.Andorid</title>
    <base href="/" />
    <!--<link rel="stylesheet" href="css/bootstrap/bootstrap.min.css" />-->
    <link rel="stylesheet" href="css/app.css" />
    <link rel="stylesheet" href="Watermark.Andorid.styles.css" />
    <link href="_content/MudBlazor/MudBlazor.min.css" rel="stylesheet" />
    <link rel="icon" type="image/png" href="favicon.png" />
    <script src="js/jquery-3.7.1.min.js"></script>
</head>

<body>

    <div class="status-bar-safe-area"></div>

    <div id="app">
        <div class="modal-overlay">
            <div class="sk-wave">
                <div class="sk-wave-rect"></div>
                <div class="sk-wave-rect"></div>
                <div class="sk-wave-rect"></div>
                <div class="sk-wave-rect"></div>
                <div class="sk-wave-rect"></div>
            </div>
        </div>
    </div>

    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="" class="reload">Reload</a>
        <a class="dismiss">ðŸ—™</a>
    </div>

    <script src="_framework/blazor.webview.js" autostart="false"></script>
    <script src="_content/MudBlazor/MudBlazor.min.js"></script>

</body>

</html>

<script>
    window.getDimensions = function () {
        return {
            width: window.innerWidth,
            height: window.innerHeight
        };
    };
    window.saveAsFile = function (filename, byteArray) {
        // åˆ›å»ºä¸€ä¸ªBlobå¯¹è±¡
        var blob = new Blob([new Uint8Array(byteArray)], { type: "application/octet-stream" });

        // åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿé“¾æŽ¥
        var link = document.createElement('a');

        // è®¾ç½®é“¾æŽ¥å±žæ€§ï¼ŒåŒ…æ‹¬æ–‡ä»¶åå’ŒURL
        link.href = window.URL.createObjectURL(blob);
        link.download = filename;

        // æ¨¡æ‹Ÿç‚¹å‡»è¿™ä¸ªé“¾æŽ¥æ¥è§¦å‘ä¸‹è½½æ“ä½œ
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);


    }

    $(function () {
        var jsObjectReference;
        $("#zhifuapp").click(function () {
            // è°ƒä½£æœåŠ¡æŽ¥å£èŽ·å–æ”¯ä»˜å®appæ”¯ä»˜éœ€è¦çš„è¯·æ±‚å­—ç¬¦ä¸²ï¼ˆresï¼‰  returnUrl quitUrlå‚æ•°å¿½ç•¥è¿™æ˜¯æˆ‘è‡ªå·±æµ‹è¯•ç”¨çš„
            $.post("https://xxxx/ali/create-maui-app", { returnUrl: "", quitUrl: "" }, function (res) {
                jsObjectReference = DotNet.createJSObjectReference(window);
                DotNet.invokeMethodAsync('Watermark.Andorid.Models', 'AliPays', jsObjectReference, res)
                    .then(data => {
                        console.log(data);
                    });
            }).error(function (res) {
                alert("å‡ºçŽ°é”™è¯¯:" + JSON.stringify(res));
            })
        })
        //windowä¸Šæ³¨å†Œæ”¯ä»˜å›žè°ƒæ–¹æ³•
        window.aliPayCallBack = (res) => {
            if (jsObjectReference) {
                DotNet.disposeJSObjectReference(jsObjectReference);
            }
            DotNet.invokeMethodAsync('Watermark.Andorid.Models', 'ReLogin');
        }

    })
</script>

<style>
    .page {
        overflow-y: hidden
    }
</style>